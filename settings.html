<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link rel="stylesheet" href="./css/photon.css">
    <link rel="stylesheet" href="./settingStyle.css">
    <title>Connection Settings</title>
</head>
<body>
    <form id="form" >
        <div class="container">
            <div class="form-group">
                <label for="ip">IP Addresss</label>
                <input type="text" id="ip" name="ip" autofocus >
            </div>
            <div class="form-group">
                <label for="protocol">Protocol</label>
                <select type="number" id="protocol" name="protocol" >
                    <option value="23">Telnet</option>
                    <option value="22">SSH</option>
                </select>
            </div>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username"  >
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="text" id="password" name="password" autofocus >
            </div>
        </div>
        <button type="button" onclick="clearFields()" class="btn  save clear">Clear</button>
        <button type="submit" class="btn save">Save</button>
        <p>*If the field is blank, the default will be used.</p>
    </form>
    <script defer>
        const { ipcRenderer } = require('electron')
        const settings = require('electron-settings'); 

        console.log('File used for Persisting Data - ' +
                settings.file()); 

        settings.get('key').then(data => {
            ip.value=data.strIp
            protocol.value=data.strProtocol
            username.value=data.strUsername
            password.value=data.strPassword
            console.log('Persisted Value - ' + data);
            }) 

        const form=document.getElementById("form")
        const ip = document.getElementById("ip")
        const username = document.getElementById("username")
        const password = document.getElementById("password")
        const protocol= document.getElementById("protocol")

        form.addEventListener("submit", submitFunction)

        function submitFunction(e){
            //stop submit to file
            e.preventDefault();
            console.log('Sample Text Entered - ' + ip.value); 
            settings.setSync('key', {strIp: ip.value, strProtocol:protocol.value, strUsername: username.value, strPassword: password.value}); 
            ipcRenderer.invoke("settings", ip.value, protocol.value, username.value, password.value)
            
        }

        function clearFields(){
            form.reset()
        }
    </script>
</body>
</html>