<html>

<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
</head>
<style>
    div.smoothie-chart-tooltip {
        background: #444;
        padding: 1em;
        margin-top: 20px;
        font-family: consolas;
        color: white;
        font-size: 10px;
        pointer-events: none;
}
</style>
<body style="background: white;">
    <h1>Hello World!</h1>
    <p>
        We are using node
        <script>document.write(process.versions.node)</script>,
        Chrome
        <script>document.write(process.versions.chrome)</script>,
        and Electron
        <script>document.write(process.versions.electron)</script>.
    </p>
    <textarea id="ta" name="ta" rows="1" cols="40" readonly></textarea>
    <button onclick="connect()">Connect</button>
    <button onclick="disConnect()">DisConnect</button>
    <button onclick="startGraf()" >Start</button>

    <canvas id="mycanvas" width="500" height="200"></canvas>
    <script type="text/javascript" src="smoothie.js"></script>
    <script>
            const { ipcRenderer } = require('electron')

        // Create a time series
            var series1 = new TimeSeries();
            var series2 = new TimeSeries();

            // Find the canvas
            var canvas = document.getElementById("mycanvas");
            
           
            // Create the chart
            var chart = new SmoothieChart({ 
                labels: { fontSize: 15 },
                tooltip: true, 
                minValue: 0, 
                timestampFormatter: SmoothieChart.timeFormatter,
                maxValueScale: 1.2
                
            });

            chart.addTimeSeries(series1, { lineWidth: 3, strokeStyle: '#00ff00', fillStyle: 'rgba(0, 255, 0, 0.4)' });
            chart.addTimeSeries(series2, { lineWidth: 3, strokeStyle: 'rgb(255, 0, 255)', fillStyle: 'rgba(255, 0, 255, 0.3)' });

            chart.streamTo(canvas, 500);

            //chart.start();
            //chart.stop();

            function connect(){
                //posalji signal mainu za connect to host
                ipcRenderer.invoke('connect')
               
            }
            //status dobijen od mejna tokom i konektovanja
            ipcRenderer.on('connect-result', function (event, arg) {
               document.getElementById("ta").innerHTML= arg;                
            })

            function disConnect() {
                //posalji signal mainu za diskonect from host
                ipcRenderer.invoke('disconnect') 
            }


            function startGraf(){
                //posalji signal mainu da zapocne intervanu petlju ocitanja
                //vrijednosti i vracanja natrag dole
                ipcRenderer.invoke('startGraf')   
            }

            //rezultati dobijeni od maina unutar koje imaintervalna petlja
            ipcRenderer.on('resultValDown', function (event, arg) {              
                var resultDown = Number(arg);
                series1.append(Date.now(), resultDown);
            })

            //rezultati dobijeni od maina unutar koje imaintervalna petlja
            ipcRenderer.on('resultValUp', function (event, arg) {
                var resultUp = Number(arg);
                series2.append(Date.now(), resultUp);
            })
            
    </script>
</body>

</html>