<html>

<head>
    <meta charset="UTF-8">
    <title>RGW Monitoring Application</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link rel="stylesheet" href="./css/photon.css">
    <link rel="stylesheet" href="style.css">
</head>
<body >
    <div class="window">
        <header class="toolbar toolbar-header">
            
        
            <div class="toolbar-actions">
                <button class="btn btn-positive" onclick="connect()" id="cntBtn">Connect
                </button>
                <button class="btn btn-positive" onclick="disConnect()" id="discntBtn">DisConnect
                </button>
                <div class="form-group">
                    <label>STATUS:</label>
                    <textarea 
                        class="form-control" 
                         id="ta" name="ta" rows="1" cols="40" readonly></textarea>
                </div>
            </div>
        </header>
        <div class="tab-group">
            <div class="tab-item">
                <img class="img-circle media-object" src="./assets/etherWhite.png" width="32" height="32">
                <p>Ethernet 1</p>
            </div>
            <div class="tab-item active">
                <img class="img-circle media-object" src="./assets/ether.png" width="32" height="32">
                <p>Ethernet 2</p>
            </div>
            <div class="tab-item">
                <img class="img-circle media-object" src="./assets/etherWhite.png" width="32" height="32">
                <p>Ethernet 3</p>
            </div>
            <div class="tab-item">
                <img class="img-circle media-object" src="./assets/etherWhite.png" width="32" height="32">
                <p>Ethernet 4</p>
            </div>
            <div class="tab-item">
                <img class="img-circle media-object" src="./assets/wifiWhite.png" width="32" height="32">
                <p>WiFi</p>
            </div>
        </div>
        <div class="window-content">
            <!--
 <button class="btn btn-negative" onclick="disConnect()">DisConnect
                    </button>
                <button class="btn btn-primary" onclick="startGraf()">Start
                    </button>
            <label for="ports">Choose ethernet port</label>
            <select name="ports" id="ports" onchange="showalert()">
                <option value="1">Ethernet 1</option>
                <option value="2">Ethernet 2</option>
                <option value="3">Ethernet 3</option>
                <option value="4">Ethernet 4</option>
                <option value="5">WiFi</option>
            </select>
                    
            <label for="direct">Direction</label>
            <select name="direct" id="direct">
                <option value="1">Bidirectional</option>
                <option value="2">Downstream</option>
                <option value="3">Upstream</option>
            </select>
                -->
                    
            <canvas id="mycanvas"  width="500" height="200"></canvas>
             
        </div>
        <div class="tab-group">
            
            <div class="tab-item">
                <span class="icon icon-stop"></span>
                <p>STOP</p>
            </div>
            <div class="tab-item">
                <span class="icon icon-play"></span>
                <p>START</p>
            </div>
            <div class="tab-item">
                <span class="icon icon-pause"></span>
                <p>PAUSE</p>
            </div>
            
            
        </div>
    </div>
  
    
    <script type="text/javascript" src="smoothie.js"></script>
    <script>
            const { ipcRenderer } = require('electron')
           
        // Create a time series
            var series1 = new TimeSeries();
            var series2 = new TimeSeries();

            // Find the canvas
            var canvas = document.getElementById("mycanvas");
            var selPort = document.getElementById('ports');
            var selDirect = document.getElementById('direct');
            var ctnBtn=document.getElementById('cntBtn')
            var dctnBtn=document.getElementById('discntBtn')
            var textarea= document.getElementById("ta")

            // Create the chart
            var chart = new SmoothieChart({ 
                labels: { fontSize: 15 },
                tooltip: true, 
                minValue: 0, 
                timestampFormatter: SmoothieChart.timeFormatter,
                maxValueScale: 1.2
                
            });

            chart.addTimeSeries(series1, { lineWidth: 3, strokeStyle: '#00ff00', fillStyle: 'rgba(0, 255, 0, 0.4)' });
            chart.addTimeSeries(series2, { lineWidth: 3, strokeStyle: 'rgb(255, 0, 255)', fillStyle: 'rgba(255, 0, 255, 0.3)' });

            chart.streamTo(canvas, 500);

            //chart.start();
            //chart.stop();

            function connect(){
                //posalji signal mainu za connect to host
                ipcRenderer.invoke('connect')    
            }

            //status dobijen od mejna tokom i konektovanja
            ipcRenderer.on('connect-result', function (event, arg) {
                console.log(arg)
               if(arg.toString()=="CONNECTED"){
                    ctnBtn.style.display = 'none'
                    dctnBtn.style.display="block"
                    textarea.style.color="lightgreen"
                    
               }else{
                    ctnBtn.style.display = 'block'
                    dctnBtn.style.display = "none"
                    textarea.style.color = "lightblue"
               }
              
               textarea.innerHTML= arg; 
                     
            })

            function disConnect() {
                //posalji signal mainu za diskonect from host
                ipcRenderer.invoke('disconnect') 
            }

            //posalji signal mainu da zapocne intervanu petlju ocitanja
            //vrijednosti i vracanja natrag dole
            function startGraf(){
                var choosenPort = selPort.options[selPort.selectedIndex].value
                var choosenDir = selDirect.options[selDirect.selectedIndex].value

                ipcRenderer.invoke('startGraf', choosenPort, choosenDir)   
            }

            //rezultati dobijeni od maina unutar koje imaintervalna petlja
            ipcRenderer.on('resultValDown', function (event, arg) {              
                var resultDown = Number(arg);
                series1.append(Date.now(), resultDown);
            })

            //rezultati dobijeni od maina unutar koje imaintervalna petlja
            ipcRenderer.on('resultValUp', function (event, arg) {
                var resultUp = Number(arg);
                series2.append(Date.now(), resultUp);
            })
            
            function showalert() {
                

                }
           
    </script>
</body>

</html>