<html>

<head>
    <meta charset="UTF-8">
    <title>RGW Monitoring Application</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link rel="stylesheet" href="./css/photon.css">
    <link rel="stylesheet" href="style.css">
</head>
<body >
    <div class="window">
        <header class="toolbar toolbar-header">    
            <div class="toolbar-actions">
                <button class="btn btn-positive" onclick="connect()" id="cntBtn">Connect
                </button>
                <button class="btn btn-positive" onclick="disConnect()" id="discntBtn">DisConnect
                </button>
                <div class="form-group">
                    <textarea 
                        class="form-control" 
                        id="ta" name="ta" rows="3" cols="40"
                        placeholder="Connection closed"
                        readonly></textarea>
                </div>
            </div>
        </header>
        <div class="tab-group">
            <div class="tab-item active"  id="5" onclick="getPortid(5)">
                <img class="img-circle media-object" src="./assets/wifiWhite.png" width="32" height="32">
                <p>WiFi</p>
            </div>
            <div class="tab-item" id="1" onclick="getPortid(1)">
                <img class="img-circle media-object" src="./assets/etherWhite.png" width="32" height="32">
                <p>Ethernet 1</p>
            </div>
            <div class="tab-item" id="2" onclick="getPortid(2)">
                <img class="img-circle media-object" src="./assets/etherWhite.png" width="32" height="32">
                <p>Ethernet 2</p>
            </div>
            <div class="tab-item" id="3" onclick="getPortid(3)">
                <img class="img-circle media-object" src="./assets/etherWhite.png" width="32" height="32">
                <p>Ethernet 3</p>
            </div>
            <div class="tab-item" id="4" onclick="getPortid(4)">
                <img class="img-circle media-object" src="./assets/etherWhite.png" width="32" height="32">
                <p>Ethernet 4</p>
            </div>
           
        </div>
        <div class="window-content">
            <!--
 <button class="btn btn-negative" onclick="disConnect()">DisConnect
                    </button>
                <button class="btn btn-primary" onclick="startGraf()">Start
                    </button>
            <label for="ports">Choose ethernet port</label>
            <select name="ports" id="ports" onchange="showalert()">
                <option value="1">Ethernet 1</option>
                <option value="2">Ethernet 2</option>
                <option value="3">Ethernet 3</option>
                <option value="4">Ethernet 4</option>
                <option value="5">WiFi</option>
            </select>
                    
            <label for="direct">Direction</label>
            <select name="direct" id="direct">
                <option value="1">Bidirectional</option>
                <option value="2">Downstream</option>
                <option value="3">Upstream</option>
            </select>
                -->
                    
            <canvas id="mycanvas"  width="500" height="200"></canvas>
             
        </div>
        <div class="tab-group">           
            <div class="tab-item active2" id="down" onclick="setDownUp('down')">
                <p>DONSTREAM</p>
            </div>
            <div class="tab-item" id="stop" onclick="stopGraf()">
                <span class="icon icon-stop"></span>
                <p>STOP</p>
            </div>
            <div class="tab-item" id="start" onclick="startGraf()">
                <span class="icon icon-play"></span>
                <p>START</p>
            </div>
            <div class="tab-item active2" id="up" onclick="setDownUp('up')">
                <p>UPSTREAM</p>
            </div>
            
            
        </div>
    </div>
  
    
    <script type="text/javascript" src="smoothie.js"></script>
    <script defer>
            const { ipcRenderer } = require('electron')
           
            var choosenPort =5;
            var down=true;
            var up=true;
            var grafStarted=false;

            // Find the element
            var canvas = document.getElementById("mycanvas");

            var ctnBtn=document.getElementById('cntBtn')
            var dctnBtn=document.getElementById('discntBtn')

            var textarea= document.getElementById("ta")

            var start = document.getElementById("start")
            var stop = document.getElementById("stop")

            var downBtn = document.getElementById("down")
            var upBtn = document.getElementById("up")

            // Create a time series
            var series1 = new TimeSeries();
            var series2 = new TimeSeries();

            // Create the chart
            var chart = new SmoothieChart({ 
                labels: { fontSize: 15 },
                tooltip: true, 
                minValue: 0, 
                timestampFormatter: SmoothieChart.timeFormatter,
                maxValueScale: 1.2 
            });

            chart.addTimeSeries(series1, { lineWidth: 3, strokeStyle: '#00ff00', fillStyle: 'rgba(0, 255, 0, 0.4)' });
            chart.addTimeSeries(series2, { lineWidth: 3, strokeStyle: 'rgb(255, 0, 255)', fillStyle: 'rgba(255, 0, 255, 0.3)' });

            chart.streamTo(canvas, 500);

            //chart.start();
            //chart.stop();

            function getPortid(number){
                if(!grafStarted){
                    //remove active sa starog elementa
                    document.getElementById(choosenPort).classList.remove("active")
                    choosenPort = number;
                    //add active na novi element
                    document.getElementById(number).classList.add("active")
                }
                
            }

            function setDownUp(direction){
                if(!grafStarted){
                    if(direction=="down"){
                        down = !down
                        downBtn.classList.toggle("active2")
                    }else{
                        up=!up
                        upBtn.classList.toggle("active2")
                    } 
                }
            }

            function connect(){
                //posalji signal mainu za connect to host
                ipcRenderer.invoke('connect')    
            }

            function disConnect() {
                //posalji signal mainu za diskonect from host
                ipcRenderer.invoke('disconnect') 
            }

            //posalji signal mainu da zapocne intervanu petlju ocitanja
            //vrijednosti 
            function startGraf(){
                start.style.display="none"
                stop.style.display="block"
                stop.classList.add("active2") 
                grafStarted=true
                ipcRenderer.invoke('startGraf', choosenPort, down,up)  
                
            }
            
            function stopGraf() {
                start.style.display = "block"
                stop.style.display = "none"

                ipcRenderer.invoke('stopGraf') 
            }

            //status dobijen od mejna tokom i konektovanja
            ipcRenderer.on('connect-result', function (event, arg) {
                console.log(arg)
                if (arg.toString() == "Connection open.") {
                    ctnBtn.style.display = 'none'
                    dctnBtn.style.display = "block"
                    textarea.style.color = "lightgreen"

                } else if (arg.toString() == "Connection closed." || arg.toString() == "Conecting....") {
                    ctnBtn.style.display = 'block'
                    dctnBtn.style.display = "none"
                    textarea.style.color = "lightblue"
                } else {
                    //ENYTHING ELSE including ERROR OCURED
                    ctnBtn.style.display = 'none'
                    dctnBtn.style.display = "block"
                    textarea.style.color = "rgb(245, 87, 111)"
                }

                textarea.innerHTML = arg;

            })

            //rezultati dobijeni od maina unutar koje imaintervalna petlja
            ipcRenderer.on('resultValDown', function (event, arg) {              
                var resultDown = Number(arg);
                series1.append(Date.now(), resultDown);
            })

            //rezultati dobijeni od maina unutar koje imaintervalna petlja
            ipcRenderer.on('resultValUp', function (event, arg) {
                var resultUp = Number(arg);
                series2.append(Date.now(), resultUp);
            })
           
    </script>
</body>

</html>